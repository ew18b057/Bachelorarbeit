<!doctype html>
<html lang="de">

<head>
    <title>ew18b057 smoke detector</title>
    <meta charset="UTF-8">
    <!--css stylesheet is ignored?-->
    <link rel="stylesheet" type="text/css" href="style.css">
</head>

<body>
    <h1>smoke detector test</h1>
    <article>
        <header>
            <hr/>
            <h2>current status</h2>
            <p>bachelor thesis in progress!</p>
            <p>initial setup of user interface</p>
            <button onclick="fireAlarm()">fire alarm</button>
        </header>
    </article>
    <aside>
        <h3>Press a button to toggle an led</h3>
        <ul>
            <li><button class="led-button" data-led="0">Red</button> Status: <span class="led-status"></span></li>
            <li><button class="led-button" data-led="2">Green</button> Status: <span class="led-status"></span></li>
        </ul>
        <h4>Links to further options</h4>
        <ul>
            <li><a href="#">Test 1</a></li>
            <li><a href="#">Test 2</a></li>
            <li><a href="#">Test 3</a></li>
        </ul>
    </aside>
    <footer>
        <p>document version 3.0 created on <time>2020-02-11</time></p>
    </footer>

    <!--accessing the following script with an external js src did not work?-->
    <!--script type="text/javascript" src="fireAlarm.js"></script>-->

    <script type="text/javascript">
        // simple pop up when pressed
        function fireAlarm() {
            alert("fire alarm!");
        };
    </script>

    <script type="text/javascript">
        // Get a NodeList of elements with the class 'led-button'
        var buttons = document.querySelectorAll('.led-button');

        // Iterate through that Nodelist and add a 'click' EventListener
        Array.prototype.forEach.call(buttons, function(button) {
            button.addEventListener('click', toggleLed);
        });

        // Our event handler function for 'click' event on the LED buttons
        function toggleLed(event) {
            var button = event.target;
            var ledIndex = button.getAttribute('data-led'); // The index of the led in the Tessel.led array
            var statusNode = button.parentNode.querySelector('.led-status'); // The sibling status <span> to update

            // Create a new XHR for communicating requests to our Tessel server
            var req = new XMLHttpRequest();

            // Open a GET request to '/leds/:index'
            req.open('GET', '/leds/' + ledIndex);

            // Once the request gets a successful response, update that statusNode with the status of the LED.
            req.onload = function(e) {
                if (req.readyState == 4 && req.status == 200) {
                    var response = JSON.parse(req.responseText);
                    statusNode.textContent = response.on ? 'ON' : 'OFF';
                } else {
                    console.log('Error', e); // If something went wrong, log that event to the console.
                }
            }
            req.send(); // Send our request to the server
        }
    </script>
</body>

</html>